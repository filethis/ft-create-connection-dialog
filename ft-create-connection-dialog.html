<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-label/iron-label.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">

<!--
`ft-create-connection-dialog`
An element that accepts username and password to connect to a document source.

@demo demo/index.html
-->

<dom-module id="ft-create-connection-dialog">

    <style include="iron-flex iron-flex-alignment"></style>

    <template>

        <!-- Center things -->
        <div class="layout vertical center"
             style="width:450px;
                    padding-left:40px; padding-top:12px; padding-right:40px; padding-bottom:5px;">

            <!-- Prompt -->
            <iron-label style="font-family:Arial;
                                font-size:13px;
                                font-style:italic;
                                color:#343434;">
                Please enter your credentials for:
            </iron-label>

            <!-- Spacer -->
            <div style="height:10px;"></div>

            <!-- Source Name -->
            <div id="_sourceName"
                 style="font-family:Palatino;
                        font-size:24px;
                        color:#343434;">
                {{_sourceName}}
            </div>

            <!-- Spacer -->
            <div style="height:18px;"></div>

            <!-- Logo Box -->
            <div class="layout vertical center"
                 style="width:150px; height:65px;
                        border:1px solid #DEDEDE;
                        justify-content:center;">

                <!-- Logo -->
                <img
                        style="width:auto; max-width:100%;"
                        src="{{_sourceLogoUrl}}">
                </img>

            </div>

            <!-- Optional Note -->
            <div id="note"
                 style="font-family:Arial;
                        font-size:13px;
                        margin-top:9px;
                        color:#7F7F7F;
                        display:none;">
                {{_sourceNotes}}
            </div>

            <!-- Spacer -->
            <div style="height:38px;"></div>

            <!-- Username -->
            <div class="layout horizontal center">

                <!-- Label -->
                <div style="width:65px;
                            text-align:right;
                            font-family:Arial;
                            font-size:14px;
                            font-weight:bold;
                            color:#343434;">
                    Username
                </div>

                <!-- Spacer -->
                <div style="width:30px;"></div>

                <!-- Entry field -->
                <input id="usernameField" is="iron-input"
                       autofocus
                       on-keyup="_onKeyUp"
                       bind-value="{{username}}"
                       style="font-family:Arial;
                                font-size:15px;
                                width:350px; height:28px;
                                padding-left:6px; padding-right:6px;
                                color:#343434;">

            </div>

            <!-- Spacer -->
            <div style="height:15px;"></div>

            <!-- Password -->
            <div class="layout horizontal center">

                <!-- Label -->
                <div style="width:65px;
                            text-align:right;
                            font-family:Arial;
                            font-size:14px;
                            font-weight:bold;
                            color:#343434;">
                    Password
                </div>

                <!-- Spacer -->
                <div style="width:30px;"></div>

                <!-- Entry field -->
                <input id="passwordField" is="iron-input"
                       on-keyup="_onKeyUp"
                       type="password"
                       bind-value="{{password}}"
                       style="font-family:Arial;
                                font-size:15px;
                                width:350px; height:28px;
                                padding-left:6px; padding-right:6px;
                                color:#343434;">

            </div>

            <!-- Spacer -->
            <div style="height:14px;"></div>

            <!-- Dividing line -->
            <hr width="100" style="width:100%; height:2px; border-width:0; color:#EEEEEE; background-color:#EEEEEE"/>

            <!-- Spacer -->
            <div style="height:15px;"></div>

            <!-- Buttons -->
            <div class="layout horizontal">

                <!-- Cancel Button -->
                <paper-button dialog-dismiss raised
                              id="cancelButton"
                              style="font-family:Arial"
                              on-click="_onCancelButtonClicked">
                    Cancel
                </paper-button>

                <!-- Spacer -->
                <div style="width:10px;"></div>

                <!-- Connect Button -->
                <paper-button dialog-confirm raised
                              id="connectButton"
                              disabled$="{{!isValid}}"
                              style="font-family:Arial"
                              on-click="_onConnectButtonClicked">
                    Connect
                </paper-button>

            </div>

            <!-- Spacer -->
            <div style="height:32px;"></div>

            <!-- Informational Links -->
            <div class="layout horizontal center"
                 style="width:100%;">

                <!-- Visit source site -->
                <div class="link"
                     style="font-family:Arial;
                            font-size:15px;
                            color:#3B7FBA;
                            cursor:pointer;
                            "
                     on-click="_onVisitSourceSiteButtonClicked">
                    Visit {{_sourceName}} website
                </div>

                <!-- Spacer -->
                <div class="flex"></div>

                <!-- Is this safe? -->
                <div class="link"
                     style="font-family:Arial;
                            font-size:15px;
                            color:#3B7FBA;
                            cursor:pointer;"
                     hidden$="[[!showIsThisSafeButton]]"
                     on-click="_onIsThisSafeButtonClicked">
                    Is this safe?
                </div>
            </div>
        </div>

    </template>

    <script>
        Polymer({

            is: 'ft-create-connection-dialog',

            /**
             * Fired when the dialog is committed.
             *
             * @event commit
             * @param {Object} detail The selected connection.
             */

            /**
             * Fired when the dialog is canceled.
             *
             * @event cancel
             */

            /**
             * Fired when the "Visit Site" button is clicked.
             *
             * @event visit-source-site
             * @param {Object} detail The source to be visited.
             */

            /**
             * Fired when the "Is this safe" button is clicked.
             *
             * @event is-this-safe
             */

            properties: {

                /** Username entered by the user. */
                username:
                {
                    type: String,
                    value: "",
                    notify: true
                },

                /** Password entered by the user. */
                password:
                {
                    type: String,
                    value: "",
                    notify: true
                },

                /** FileThis "source" resource. */
                source:
                {
                    type: Object,
                    value: null,
                    notify: true
                },

                /** Show "Is this safe" button at bottom of dialog. */
                showIsThisSafeButton:
                {
                    type: Boolean,
                    value: true,
                    notify: true
                },

                /** True when the entered values are valid and the dialog can be committed. */
                isValid:
                {
                    type: Boolean,
                    value: false,
                    notify: true
                },

                _sourceLogoUrl:
                {
                    type: String,
                    computed: '_getSourceLogoUrl(source)'
                },

                _sourceName:
                {
                    type: String,
                    computed: '_getSourceName(source)'
                },

                _sourceNotes:
                {
                    type: String,
                    computed: '_getSourceNotes(source)'
                }
            },

            ready: function()
            {
                this.initialize();
            },

            /** Call this when posing modally. */
            initialize: function()
            {
                this.username = "";
                this.password = "";
                this._validateCredentials();
                this.$.usernameField.focus();
            },

            _credentialsAreValid: function()
            {
                if (this.username.length == 0)
                    return false;
                if (this.password.length == 0)
                    return false;
                return true;
            },

            _validateCredentials: function()
            {
                this.isValid = this._credentialsAreValid();
            },

            _onKeyUp: function(event)
            {
                this._validateCredentials();
            },

            _onCancelButtonClicked: function(event, detail)
            {
                this.fire('cancel');
            },

            _onConnectButtonClicked: function(event, detail)
            {
                this.fire('commit', this.source);
            },

            _onVisitSourceSiteButtonClicked: function(event, detail)
            {
                this.fire('visit-source-site', this.source);
            },

            _onIsThisSafeButtonClicked: function(event, detail)
            {
                this.fire('is-this-safe');
            },

            _getSourceLogoUrl: function(source)
            {
                if (source == null)
                    return "";
                return source.logoUrl;
            },

            _getSourceName: function(source)
            {
                if (source == null)
                    return "";
                return source.name;
            },

            _getSourceNotes: function(source)
            {
                if (source == null)
                    return "";
                return source.notes;
            }

        });
    </script>
</dom-module>
